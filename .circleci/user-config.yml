# This is an example of a user CircleCI configuration that is not generated by
# Aspect Workflows. The naming of this file is arbitrary. This configuration is
# merged with the generated Aspect Workflows CircleCI configuration into the
# load bearing load `.circleci/config.yaml` configuration file that is used by
# CircleCI.
#
# To update `.circleci/config.yaml` after editing this file run:
#
#    bazel run //.circleci:write_merged_config
#
# The following workflows names are currently reserved by Aspect Workflows:
#
# - aspect-workflows
# - aspect-workflows-warming
# - manual_deliver
#
# The following job names are currently reserved by Aspect Workflows:
#
# - auto_deliver
# - buildifier
# - configure
# - format
# - gazelle
# - manual_deliver
# - test
# - warming
#
# If a conflicting workflow or job name is used in this configuration it will result in a bad
# configuration merge. We plan to add a common prefix to all Aspect Workflows jobs in a future
# release so that the a job name such as 'test' is not reserved.
version: 2.1

# Aspect Workflows parameters for delivery; not required if delivery is not enabled.
parameters:
  perform_delivery:
    type: boolean
    default: false
  delivery_commit:
    type: string
    default: ''
    description: The commit to checkout and run the delivery from
  delivery_targets:
    type: string
    default: ''
    description: Ignore the target(s) that are listed in the delivery manifest
      and instead deliver these targets. Comma-separated list of labels.

jobs:
  user-job:
    docker:
      - image: cimg/base:2023.03
    steps:
      - checkout
      - run: echo "Example user CircleCI job that is not generated by Aspect Workflows."

workflows:
  user-workflow:
    jobs:
      - user-job
    when:
      and:
        - not: << pipeline.parameters.perform_delivery >>
        - not:
            equal:
              - << pipeline.trigger_source >>
              - scheduled_pipeline
