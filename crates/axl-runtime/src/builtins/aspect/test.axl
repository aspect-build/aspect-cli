load("./common.axl", "tui")

def _test_impl(ctx):
    stdout = ctx.std.io.stdout
    stderr = ctx.std.io.stderr
    test = ctx.bazel.build(
        build_events = True,
        command = "test",
        flags = ["--isatty=" + str(int(stdout.is_tty))],
        *ctx.args.pattern
    )
    return tui(ctx, test)

test = task(
    implementation = _test_impl,
    args = {
        # TODO: Support a long --pattern_file like bazel does (@./targets)
        # TODO: Support - (list from stdin)
        "pattern": args.positional(default = ["..."]),
    }
)
