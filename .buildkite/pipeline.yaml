# Generated by: aspect workflows migrate --host=buildkite
# Source: .aspect/workflows/config_aws.yaml
# DO NOT EDIT - regenerate with 'aspect workflows migrate'

steps:
  - key: __main__::lint
    label: ":bazel: Lint"
    agents:
      queue: aspect-default
    timeout_in_minutes: 60
    env:
      ASPECT_WORKFLOWS_CONFIG: .aspect/workflows/config_aws.yaml
    command:
      - 'echo "--- :bazel: Lint"'
      - aspect lint
    retry:
      automatic:
        - exit_status: -1
          limit: 1
      manual:
        allowed: true
        permit_on_passed: false

  - key: __main__::format
    label: ":bazel: Format"
    agents:
      queue: aspect-default
    timeout_in_minutes: 60
    env:
      ASPECT_WORKFLOWS_CONFIG: .aspect/workflows/config_aws.yaml
    command:
      - 'echo "--- :bazel: Format"'
      - aspect format
    retry:
      automatic:
        - exit_status: -1
          limit: 1
      manual:
        allowed: true
        permit_on_passed: false

  - key: __main__::buildifier
    label: ":bazel: Buildifier"
    agents:
      queue: aspect-default
    timeout_in_minutes: 60
    env:
      ASPECT_WORKFLOWS_CONFIG: .aspect/workflows/config_aws.yaml
    command:
      - 'echo "--- :bazel: Buildifier"'
      - aspect buildifier
    retry:
      automatic:
        - exit_status: -1
          limit: 1
      manual:
        allowed: true
        permit_on_passed: false

  - key: __main__::gazelle
    label: ":bazel: Gazelle"
    agents:
      queue: aspect-default
    timeout_in_minutes: 60
    command:
      - 'echo "--- :bazel: Gazelle"'
      - aspect gazelle
    retry:
      automatic:
        - exit_status: -1
          limit: 1
      manual:
        allowed: true
        permit_on_passed: false

  - key: __main__::test
    label: ":bazel: Test"
    agents:
      queue: aspect-default
    timeout_in_minutes: 60
    env:
      ASPECT_WORKFLOWS_CONFIG: .aspect/workflows/config_aws.yaml
      ASPECT_BEP_USE_PIPE: "1"
    command:
      - "vmstat -a -S M -t 5 2>&1 > vmstat.out &"
      - 'echo "--- :bazel: Test"'
      - aspect test
      - "cp /etc/bazel.bazelrc workflows-etc-bazel.bazelrc"
    artifact_paths:
      - "vmstat.out"
      - "workflows-etc-bazel.bazelrc"
      - "bes.pb"
      - "bes.json"
      - "compact.exec.log"
    retry:
      automatic:
        - exit_status: -1
          limit: 1
      manual:
        allowed: true
        permit_on_passed: false
